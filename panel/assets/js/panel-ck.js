var panel={init:function(){$(".growl").click(function(){$(this).remove()});$("form").submit(function(){$(this).addClass("loading")});$(".form-buttons").formbuttons();$(".overlay").not(".hide").find("input").first().focus();var e=$(".subpages.sortable ul");e.length&&e.sortable({axis:"y",scroll:!0,connectWith:e,receive:function(e,t){var n=$(".subpages .visible"),r=n.find("li").not(".empty").length,i=$(".subpages .invisible"),s=i.find("li").not(".empty").length;r==0?n.find(".empty").removeClass("hide"):n.find(".empty").addClass("hide");s==0?i.find(".empty").removeClass("hide"):i.find(".empty").addClass("hide");t.sender.hasClass("visible")?t.item.find("input").attr("name","invisible[]"):t.item.find("input").attr("name","visible[]")}}).disableSelection();$(".files").length&&$(".files a[rel=image]").fancybox({padding:20,cyclic:!0,overlayOpacity:.9,overlayColor:"#000",showCloseButton:!1,changeSpeed:0,changeFade:0,speedOut:200});$(".subpages a.more").click(function(){var e=$(this);switch(e.attr("href")){case"#more-visible":$(".subpages ul.visible li.more").show();e.text(e.attr("data-less")).attr("href","#less-visible");e.addClass("less");break;case"#more-invisible":$(".subpages ul.invisible li.more").show();e.text(e.attr("data-less")).attr("href","#less-invisible");e.addClass("less");break;case"#less-visible":$(".subpages ul.visible li.more").hide();e.text(e.attr("data-more")).attr("href","#more-visible");e.removeClass("less");break;case"#less-invisible":$(".subpages ul.invisible li.more").hide();e.text(e.attr("data-more")).attr("href","#more-invisible");e.removeClass("less")}return!1})},overlay:{open:function(e){$(".overlay").hide();var t=$(e);if(!t.length)return!1;var n=$('<div class="overlay-blocker"></div>').css({top:0,right:0,bottom:0,left:0,width:"100%",height:"100%",position:"fixed",zIndex:1999,background:"#fff",opacity:.9});$("body").append(n);t.show();t.find("input:first").focus()},close:function(){$(".overlay").hide();$(".overlay-blocker").remove()}}};$(function(){panel.init()});(function(e){e.formbuttons=function(t){var n=this;n.bar=e(t);n.init=function(){n.area=n.bar.next("textarea").first();n.bar.find("a[rel=tag]").click(function(){var t=e(this),r=t.attr("data-tag-open"),i=t.attr("data-tag-close"),s=t.attr("data-tag-sample");n.tag(r,i,s);return!1});n.bar.find("a[rel=overlay]").click(function(){var t=e(this),r=t.attr("href"),i=e(r);i.data("area",n.area);i.data("callback",function(){n.link(i)});panel.overlay.open(i);return!1})};n.tag=function(e,t,n){var r=this.area[0];n||(n="");t||(t="");if(document.selection){var i=document.selection.createRange().text;i||(i=n);r.focus();document.selection.createRange().text=e+i+t}else if(r.selectionStart||r.selectionStart=="0"){var s=r.selectionStart,o=r.selectionEnd,u=r.scrollTop,a=r.value,f=a.substring(s,o);f||(f=n);var l=e+f+t;r.value=a.substring(0,s)+l+a.substring(o,a.length);r.focus();var c=s+l.length;r.selectionStart=c;r.selectionEnd=c;r.scrollTop=u}};n.insert=function(e){var t=this.area[0];if(document.selection&&!window.opera){t.focus();selection=document.selection.createRange();selection.text=e}else if(t.selectionStart||t.selectionStart=="0"){var n=t.selectionStart,r=t.selectionEnd,i=t.value;t.value=i.substring(0,n)+e+i.substring(r,i.length);t.focus()}else{t.value+=e;t.focus()}};n.link=function(t){var n=t.find("input[name=link]"),r=t.find("input[name=text]"),i=t.attr("data-tag"),s=e.trim(n.val()),o=e.trim(r.val());n.val("");r.val("");return s.length?!o.length||o==s?this.insert("<"+s+">"):this.insert("("+i+": "+s+" text: "+o+")"):this.insert("")};n.init()};e.fn.formbuttons=function(t){e(".form-overlay").each(function(){var t=e(this);t.find("input[type=submit]").click(function(){e(this).is(".cancel")==0&&t.data("callback")();panel.overlay.close();t.data("area").focus();return!1})});return this.each(function(){if(undefined==e(this).data("formbuttons")){var n=new e.formbuttons(this,t);e(this).data("formbuttons",n)}})}})(jQuery);